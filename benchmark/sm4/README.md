# 编译

在compute_benchmarks/目录下，进行编译：

```
mkdir build
cd build
cmake ..
make -j8
```

编译完成，可以执行文件在目录`compute_benchmarks/build/benchmark/sm4`下面。


# 运行

可执行文件放在`compute_benchmarks/build/benchmark/sm4`下面，可以直接运行：

```
./sm4
```

注意：默认编译出来的程序，执行的是死循环，只能验证单个平台的执行速度。
如果当前机器有多个平台，想测试多个平台总共的执行速度，则需要把main.cpp文件中的宏DEAD_LOOP进行注释。

## 一个平台

```
./sm -t 1 -g 1 -l 1024
```

解释：在当前平台上运行【一个线程】，有【一个命令队列】，共【写入-执行-读取1024次】。

```
./sm -t 2 -g 1 -l 1024
```

解释：在当前平台上运行【两个线程】，每个线程中，有【一个命令队列】，每个线程中，共【写入-执行-读取1024次】。

```
./sm -t 1 -g 2 -l 2048
```

解释：在当前平台上运行【一个线程】，有【两个个命令队列】，每个线程中，共【写入-执行-读取2048次】。

```
./sm -t 2 -g 2 -l 2048
```

解释：在当前平台上运行【两个线程】，每个线程中，有【两个个命令队列】，共【写入-执行-读取2048次】。

## 多个平台

### 指定平台

```
./sm -d 0 -t 1 -g 1 -l 1024
```

解释：通过`-d`指定使用0号平台，运行【一个线程】，有【一个命令队列】，共【写入-执行-读取1024次】。

对于多个平台环境下，对于当个平台的验证，只需要指定平台即可。

### 所有平台

注意，使用这种方式的前提是，把main.cpp文件中的宏DEAD_LOOP进行注释。

```
./sm -p 4 -t 1 -g 1 -l 1024
```

解释：通过`-p`指定所使用的平台个数，在每一个平台上，运行【一个线程】，有【一个命令队列】，共【写入-执行-读取1024次】。